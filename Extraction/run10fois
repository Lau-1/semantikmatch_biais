import subprocess
import sys
import time

scripts_to_run = ["Extraction/extract_experiences_with_llm.py", "Extraction/extract_interests_with_llm.py", "Extraction/extract_studies_with_llm.py"]
iterations = 10

print(f"D√©marrage OPTIMIS√â (Parall√®le) : {iterations} it√©rations.")
global_start = time.time()

for i in range(1, iterations + 1):
    iter_start = time.time()
    print(f"\nüîÑ IT√âRATION {i} / {iterations}")
    print(f"   Lancement simultan√© de : {', '.join(scripts_to_run)}...")

    processes = []

    # 1. Lancer tous les scripts en arri√®re-plan
    for script in scripts_to_run:
        p = subprocess.Popen([sys.executable, script])
        processes.append((script, p))

    # 2. Attendre qu'ils finissent tous
    for script_name, process in processes:
        exit_code = process.wait()
        if exit_code == 0:
            print(f"   ‚úÖ {script_name} termin√©.")
        else:
            print(f"   ‚ùå {script_name} a √©chou√© (code {exit_code}).")

    iter_duration = time.time() - iter_start
    print(f"It√©ration {i} termin√©e en {round(iter_duration)} secondes.")

total_duration = time.time() - global_start
print(f"\nüéâ Termin√© en {round(total_duration / 60, 1)} minutes.")
