import subprocess
import sys
import time

scripts_to_run = ["Extraction/extract_experiences_with_llm.py", "Extraction/extract_interests_with_llm.py", "Extraction/extract_studies_with_llm.py"]
iterations = 10

print(f"ğŸš€ DÃ©marrage OPTIMISÃ‰ (ParallÃ¨le) : {iterations} itÃ©rations.")
global_start = time.time()

for i in range(1, iterations + 1):
    iter_start = time.time()
    print(f"\nğŸ”„ ITÃ‰RATION {i} / {iterations}")
    print(f"   Lancement simultanÃ© de : {', '.join(scripts_to_run)}...")

    processes = []

    # 1. Lancer tous les scripts en arriÃ¨re-plan
    for script in scripts_to_run:
        # Popen lance le processus sans attendre qu'il finisse
        p = subprocess.Popen([sys.executable, script])
        processes.append((script, p))

    # 2. Attendre qu'ils finissent tous
    for script_name, process in processes:
        exit_code = process.wait() # On bloque ici tant que ce n'est pas fini
        if exit_code == 0:
            print(f"   âœ… {script_name} terminÃ©.")
        else:
            print(f"   âŒ {script_name} a Ã©chouÃ© (code {exit_code}).")

    # Calcul du temps de l'itÃ©ration
    iter_duration = time.time() - iter_start
    print(f"   â±ï¸  ItÃ©ration {i} terminÃ©e en {round(iter_duration)} secondes.")

total_duration = time.time() - global_start
print(f"\nğŸ‰ TerminÃ© en {round(total_duration / 60, 1)} minutes.")
